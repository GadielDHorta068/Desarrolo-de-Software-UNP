<!-- Modern Event Management Interface -->
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800">
  <!-- Header Section -->
  <div class="container mx-auto px-6 sm:px-8 lg:px-12 py-12">
    <!-- Page Header -->
    <div class="mb-8">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-6 mb-6">
        <div class="flex items-center gap-2 sm:gap-4 flex-wrap">
          <button (click)="goHome()"
            class="p-2 rounded-full bg-white dark:bg-gray-800 shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105">
            <svg class="w-5 h-5 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <h1
            class="text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent">
            {{ event?.title }}
          </h1>
          <span *ngIf="event" class="privacy-icon" [title]="event.isPrivate ? 'Evento privado' : 'Evento público'"
            [ngClass]="event.isPrivate 
                  ? 'bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-300 border-red-200 dark:border-red-700' 
                  : 'bg-green-100 text-green-600 dark:bg-green-900 dark:text-green-300 border-green-200 dark:border-green-700'">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <ng-container *ngIf="event.isPrivate; else publicIcon">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </ng-container>
              <ng-template #publicIcon>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 2a10 10 0 100 20 10 10 0 000-20zm0 0c2.5 2.5 4 6 4 10s-1.5 7.5-4 10m0-20c-2.5 2.5-4 6-4 10s1.5 7.5 4 10m-8-10h16" />
              </ng-template>
            </svg>
          </span>
          <div class="hidden sm:flex items-center space-x-2">
            <span class="px-3 py-1 text-xs font-semibold rounded-full" [ngClass]="{
                    'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100': event?.statusEvent === StatusEvent.OPEN,
                    'bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100': event?.statusEvent === StatusEvent.CLOSED,
                    'bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100': event?.statusEvent === StatusEvent.FINISHED
                  }">
              {{ event?.statusEvent }}
            </span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex w-full sm:w-auto items-center gap-2 sm:gap-3 flex-wrap justify-start sm:justify-end">
          <button *ngIf="canUserInscript && !isAdmin" (click)="onInscript()"
            class="flex-shrink-0 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 transform">
            <span class="flex items-center space-x-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              <span>Inscribirme</span>
            </span>
          </button>

          <button *ngIf="isUserCreator" routerLink="/event/management/edit/{{event?.id}}"
            class="flex-shrink-0 px-6 py-3 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 transform">
            <span class="flex items-center space-x-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
              <span>Editar</span>
            </span>
          </button>

          <button *ngIf="isUserCreator" (click)="modalShareEvent.open()"
            class="flex-shrink-0 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 transform">
            <span class="flex items-center space-x-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" />
              </svg>
              <span>Compartir</span>
            </span>
          </button>
        </div>
      </div>

      <!-- Mobile Status Badge -->
      <div class="sm:hidden mb-4">
        <span class="px-3 py-1 text-xs font-semibold rounded-full" [ngClass]="{
                'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100': event?.statusEvent === StatusEvent.OPEN,
                'bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100': event?.statusEvent === StatusEvent.CLOSED,
                'bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100': event?.statusEvent === StatusEvent.FINISHED
              }">
          {{ event?.statusEvent }}
        </span>
      </div>

      <!-- Navigation Tabs -->
      <div class="border-b border-gray-200 dark:border-gray-700">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
          <button (click)="tab = TAB_INFO"
            class="py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200 hover:text-gray-700 dark:hover:text-gray-200"
            [ngClass]="isInfoTab() ? 'border-blue-500 text-blue-600 dark:text-blue-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'">
            <span class="flex items-center space-x-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span>Información</span>
            </span>
          </button>

          <button (click)="setTab(TAB_REGISTERED)"
            class="py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200 hover:text-gray-700 dark:hover:text-gray-200"
            [ngClass]="isRegisteredTab() ? 'border-blue-500 text-blue-600 dark:text-blue-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'">
            <span class="flex items-center space-x-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
              <span>Registrados</span>
              <span *ngIf="participants.length > 0" class="ml-2 py-0.5 px-2.5 text-xs font-medium rounded-full"
                [ngClass]="isRegisteredTab() ? 'bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100' : 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100'">
                {{ participants.length }}
              </span>
            </span>
          </button>
        </nav>
      </div>
    </div>

    <!-- Main Content -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
      <!-- Left Column: Event Information & QR -->
      <div class="lg:col-span-2 space-y-8">
        <!-- Information Tab Content -->
        <div *ngIf="isInfoTab()" class="space-y-8">
          <!-- Event Details Card -->
          <div class="card-modern">
            <div class="card-header">
              <h2 class="card-title">Detalles del Evento</h2>
              <p class="card-subtitle">Información completa sobre tu evento</p>
            </div>
            <app-info-event [event]="event" [winners]="winners"></app-info-event>
          </div>

          <!-- Event Share Card (for creators) -->
          <div *ngIf="isUserCreator && event?.id" class="card-modern">
            <div class="card-header">
              <h2 class="card-title">Compartir Evento</h2>
              <p class="card-subtitle">Comparte el enlace corto y código QR con tus invitados</p>
            </div>
            <app-event-share-card [eventId]="event?.id"></app-event-share-card>
          </div>
        </div>

        <!-- Registered Participants Tab -->
        <div *ngIf="isRegisteredTab()" class="card-modern">
          <div class="card-header">
            <h2 class="card-title">Participantes Registrados</h2>
            <p class="card-subtitle">Lista de todos los participantes inscritos en el evento</p>
          </div>

          <div
            *ngIf="(eventType !== typesOfEventes.RAFFLES && participants.length > 0) || (eventType === typesOfEventes.RAFFLES && raffleParticipantsGrouped.length > 0); else noParticipants"
            class="p-6 space-y-4">
            <!-- Grid para sorteos (no rifas) -->
            <div *ngIf="eventType !== typesOfEventes.RAFFLES"
              class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
              <div *ngFor="let p of participants" class="participant-card">
                <div class="participant-avatar">
                  <span class="text-lg font-semibold">{{ p.name.charAt(0) }}{{ p.surname.charAt(0) }}</span>
                </div>
                <div class="participant-info">
                  <h3 class="font-semibold text-gray-900 dark:text-white">{{ p.name }} {{ p.surname }}</h3>
                  <p class="text-sm text-gray-600 dark:text-gray-400">{{ p.email }}</p>
                  <div *ngIf="getGoalByEmailIfFinished(p.email) as dataGoal" class="mt-2 flex items-center space-x-2">
                    <app-tag-prize [position]="dataGoal.position"></app-tag-prize>
                    <a [routerLink]="['/chat', dataGoal.idUser]"
                      class="text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium">
                      Ir al chat
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Grid para rifas: agrupado por participante -->
            <div *ngIf="eventType === typesOfEventes.RAFFLES"
              class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
              <div *ngFor="let gp of raffleParticipantsGrouped" class="participant-card">
                <div class="participant-avatar">
                  <span class="text-lg font-semibold">{{ gp.name.charAt(0) }}{{ gp.surname.charAt(0) }}</span>
                </div>
                <div class="participant-info">
                  <h3 class="font-semibold text-gray-900 dark:text-white">{{ gp.name }} {{ gp.surname }}</h3>
                  <p class="text-sm text-gray-600 dark:text-gray-400">{{ gp.email }}</p>
                  <div class="raffle-numbers">
                    <span *ngFor="let n of getDisplayedNumbers(gp.email, gp.numbers)" class="raffle-number-chip"
                      [ngClass]="(getWinningRaffleNumber(gp.email) === n) ? 'raffle-number-chip-winner' : ''">
                      Nº {{ n }}
                    </span>
                    <span *ngIf="getRemainingCount(gp.email, gp.numbers) as rest" class="raffle-toggle-chip"
                      (click)="toggleExpanded(gp.email)">
                      +{{ rest }} más
                    </span>
                    <span *ngIf="isExpanded(gp.email) && gp.numbers.length > raffleNumbersLimit"
                      class="raffle-toggle-chip" (click)="toggleExpanded(gp.email)">
                      Ver menos
                    </span>
                  </div>
                  <div *ngIf="getGoalByEmailIfFinished(gp.email) as dataGoal"
                    class="mt-3 flex items-center gap-2 flex-wrap">
                    <app-tag-prize [position]="dataGoal.position"></app-tag-prize>
                    <span *ngIf="getWinningRaffleNumber(gp.email) as winNum"
                      class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100">
                      Nº ganador: {{ winNum }}
                    </span>
                    <a [routerLink]="['/chat', dataGoal.idUser]"
                      class="text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium">
                      Ir al chat
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noParticipants>
            <div class="text-center py-12">
              <div
                class="w-16 h-16 mx-auto mb-4 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor"
                  viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
              </div>
              <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Aún no hay participantes</h3>
              <p class="text-gray-600 dark:text-gray-400">Los primeros participantes aparecerán aquí cuando se
                registren.</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Right Column: Quick Stats & Actions -->
      <div class="space-y-6">
        <!-- Quick Stats Card -->
        <div class="card-modern">
          <div class="card-header">
            <h3 class="card-title">Estadísticas Rápidas</h3>
          </div>
          <div class="p-6 space-y-4">
            <div class="flex justify-between items-center">
              <span class="text-gray-600 dark:text-gray-400">Participantes</span>
              <span class="font-semibold text-gray-900 dark:text-white">{{ participants.length }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-600 dark:text-gray-400">Cant. Ganadores</span>
              <span class="font-semibold text-gray-900 dark:text-white">{{ event?.winnersCount }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-600 dark:text-gray-400">Fecha de realizacion</span>
              <span class="font-semibold text-gray-900 dark:text-white">{{ event?.endDate | handleDatePipe }}</span>
            </div>
          </div>
        </div>

        <!-- Report Section -->
        <div *ngIf="!isUserCreator && !hasReport" class="card-modern border-l-4 border-orange-500">
          <div class="card-header">
            <h3 class="card-title text-orange-800 dark:text-orange-200">¿Problemas con el evento?</h3>
            <p class="card-subtitle text-orange-700 dark:text-orange-300">Reporta cualquier inconveniente</p>
          </div>
          <div class="p-6 pt-0 px-0 pb-0">
            <button (click)="onReport()"
              class="block w-full py-3 bg-orange-500 hover:bg-orange-600 text-white font-medium rounded-b-2xl transition-colors duration-200">
              Reportar Evento
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Access Restricted Overlay -->
<div *ngIf="accessRestricted" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center">
  <div
    class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-[90%] max-w-md text-center transform transition-all duration-300 scale-100">
    <div class="w-16 h-16 mx-auto mb-4 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center">
      <svg class="w-8 h-8 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
      </svg>
    </div>
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Acceso Restringido</h2>
    <p class="text-gray-600 dark:text-gray-400 mb-6">Este es un evento privado. Necesitas el enlace de invitación o ser
      el organizador para acceder.</p>
    <button (click)="goHome()"
      class="w-full px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl transition-colors duration-200">
      Volver al Inicio
    </button>
  </div>
</div>

<!-- Modals -->
<app-modal-share-event #modalShareEvent [eventId]="event?.id"></app-modal-share-event>
<app-invite-login *ngIf="showInviteLogin" (close)="onInviteClosed($event)"></app-invite-login>
<app-reports-form *ngIf="showFormReport" (informReport)="resultReport($event)"
  (close)="onReportClosed()"></app-reports-form>
