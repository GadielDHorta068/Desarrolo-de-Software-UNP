<div class="card-modern hover-lift" [ngClass]="customBackground()">
  <app-loading-indicator [active]="isActionLoading" [type]="'overlay'" [message]="'Procesando...'" [size]="'md'"></app-loading-indicator>
  <div class="card-header">
    <div class="flex items-center gap-3">
      <div class="icon-circle">
        <img class="w-6 h-6" [src]="event?.eventType | handleIconTypePipe" alt="">
      </div>
      <h2 class="card-title">{{event?.title}}</h2>
      <span class="privacy-chip" [ngClass]="event?.isPrivate ? 'chip-private' : 'chip-public'">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <ng-container *ngIf="event?.isPrivate; else publicIcon">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </ng-container>
          <ng-template #publicIcon>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2a10 10 0 100 20 10 10 0 000-20zm0 0c2.5 2.5 4 6 4 10s-1.5 7.5-4 10m0-20c-2.5 2.5-4 6-4 10s1.5 7.5 4 10m-8-10h16" />
          </ng-template>
        </svg>
        <span>{{ event?.isPrivate ? 'Privado' : 'Público' }}</span>
      </span>
    </div>
    <div *ngIf="showRegisteredStatus" class="badge-registered mt-3">
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
      </svg>
      Estas inscrito
    </div>
  </div>

  <div class="p-6 card-grid">
    <div class="space-y-3">
      <div>
        <p class="text-sm text-gray-800 dark:text-gray-200 font-medium">Descripción</p>
        <p class="text-sm text-gray-600 dark:text-gray-400">{{event?.description}}</p>
      </div>
      <div>
        <p class="text-sm text-gray-800 dark:text-gray-200 font-medium">Fecha fin</p>
        <p class="text-sm text-gray-600 dark:text-gray-400">{{event?.endDate | handleDatePipe}}</p>
      </div>
      <div>
        <p class="text-sm text-gray-800 dark:text-gray-200 font-medium">Estado</p>
        <p class="text-sm text-gray-600 dark:text-gray-400">{{event?.statusEvent | handleStatusPipe}}</p>
      </div>
      <div>
        <p class="text-sm text-gray-800 dark:text-gray-200 font-medium">Categoría</p>
        <p class="text-sm text-gray-600 dark:text-gray-400">{{event?.categoryName || 'Sin categoría'}}</p>
      </div>
      <div>
        <p class="text-sm text-gray-800 dark:text-gray-200 font-medium">Reputación del creador</p>
        <app-star-rating [rating]="avgScore"></app-star-rating>
      </div>
    </div>

    <div class="flex items-center">
      <img 
        [src]="event?.imageUrl ? 'data:image/jpeg;base64,' + event?.imageUrl : 'assets/no-image.jpg'" 
        [alt]="event?.title || 'Imagen del evento'"
        class="image-preview"
        [class.border]="event?.imageUrl"
        [class.border-gray-300]="event?.imageUrl">
    </div>
  </div>

  <div class="action-row">
    <button class="btn-action bg-emerald-600 dark:bg-emerald-500 hover:bg-emerald-700 dark:hover:bg-emerald-600" (click)="redirectAdmin()">Ver detalles</button>

    <button *ngIf="isUserCreator && event?.statusEvent === StatusEvent.OPEN" class="btn-action bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-600" (click)="closeRegistrations()">Cerrar evento</button>

    <button *ngIf="isUserCreator && event?.statusEvent === StatusEvent.CLOSED" class="btn-action bg-purple-600 dark:bg-purple-500 hover:bg-purple-700 dark:hover:bg-purple-600" (click)="finalizeEvent()">Finalizar sorteo</button>

    <button *ngIf="!isAdmin && showRegisterButton" class="btn-action bg-orange-600 dark:bg-orange-300 hover:bg-orange-500 dark:hover:bg-orange-400 flex items-center gap-2" [disabled]="isActionLoading || !event?.id" (click)="onInscript()">
      <app-loading-indicator [active]="isActionLoading" [type]="'inline'" [size]="'sm'"></app-loading-indicator>
      Inscribirme
    </button>

    <button *ngIf="!isAdmin && !isAuthenticated && !isUserCreator && event?.statusEvent === StatusEvent.OPEN" class="btn-action bg-orange-600 dark:bg-orange-300 hover:bg-orange-500 dark:hover:bg-orange-400 flex items-center gap-2" [disabled]="isActionLoading || !event?.id" (click)="onInscript()">
      <app-loading-indicator [active]="isActionLoading" [type]="'inline'" [size]="'sm'"></app-loading-indicator>
      Participar!
    </button>

    <button *ngIf="isAdmin" class="btn-action bg-orange-500 dark:bg-orange-500 hover:bg-orange-600 dark:hover:bg-orange-400" [disabled]="!event?.id" (click)="onRedirectReports()">Ver reportes</button>
  </div>
</div>

<app-modal-draw-info [dataEvent]="event" #modalEventInfo></app-modal-draw-info>
<app-modal-info [dataModal]="dataModal" #modalInfo></app-modal-info>
<!-- form de inscripcion a sorteos -->
 <!-- <app-questionary *ngIf = "showFormGiveaway" (close) = "showFormGiveaway = false" [eventId] = "selectedEventId"></app-questionary> -->